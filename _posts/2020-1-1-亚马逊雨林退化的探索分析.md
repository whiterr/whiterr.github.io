---
layout: post
title: 亚马逊雨林退化的探索分析
tags: data_visualization,exploratory_analysis
stickie: false
---

## 背景描述

亚马逊雨林是亚马逊生物群落中潮湿的阔叶热带雨林，分布在九个国家的领土中。大部分森林位于巴西境内，占雨林的60％，其次是秘鲁（占13％），哥伦比亚（占10％），以及委内瑞拉、厄瓜多尔、玻利维亚、圭亚那、苏里南和法属圭亚那，地理分布如下图所示。

![](https://whiterr.github.io/images/Brazilian_rain_forest/start.jpg)

亚马逊雨林在南美洲乃至全球尤为重要，近500个土著社区在亚马逊雨林中安家。这是一个生物高度多样化的生态系统，拥有众多动植物物种，雨林可以创造自己的天气并影响世界各地的气候。不幸的是，雨林的生态系统不断面临着众多的威胁，有自然也有人为的原因，如野火、森林砍伐等等。

![](https://whiterr.github.io/images/Brazilian_rain_forest/start2.jpg)

造成森林砍伐的原因有很多，例如非法农业，自然灾害，城市化和采矿。尽管当今世界各地都在滥砍滥伐，但在亚马逊雨林中，这是一个尤为关键的问题，因为它是世界上唯一至今屹立的大森林。在那里，动植物种类正在以惊人的速度消失。

## 数据说明

从[kaggle](https://www.kaggle.com/mbogernetto/brazilian-amazon-rainforest-degradation)获取的公开数据，该数据于2019年12月13日从INPE网站中提取，INPE网站通过卫星图像检测火灾爆发，每3小时更新一次。

`inpe_brazilian_amazon_fires_1999_2019.csv`：按州、月份和年份统计在从1999年到2019年巴西亚马逊地区发生的火灾总数。


```python
# "def_area_2004_2019.csv"：2004年至2019年按州和州划分的森林砍伐面积（km²）。数据为公开数据，于2019年12月16日从INPE网站提取。该数据已汇总，因此未进行数据处理。计划：PRODES（巴西卫星电视台监测计划，或巴西卫星雨林监测计划）。方法：采用卫星图像绘制原始森林的流失图，具有20至30米的空间分辨率和16天的重访率，以求最大程度地减少云层覆盖的问题并确保互操作性标准。

# "el_nino_la_nina_1999_2019.csv"：有关最重要的两种气候现象的开始年，结束年和严重性的数据。数据是从2019年12月20日的金门气象服务中提取的，并且没有进行数据透视。
```



# 目录

1. [巴西亚马逊雨林的退化是否正在加剧？](#1.巴西亚马逊雨林的退化是否正在加剧？) 
2. [火灾的行为是什么，火灾在何时何地发生？](#2.火灾的行为是什么，火灾在何时何地发生？)  
3. [火灾爆发次数与森林砍伐面积之间的关系如何？](#3.火灾爆发次数与森林砍伐面积之间的关系如何？)
4. [厄尔尼诺现象和拉尼娜现象对亚马逊雨林退化的影响是什么？](#4.厄尔尼诺现象和拉尼娜现象对亚马逊雨林退化的影响是什么？)
5. [是否有造成森林退化的自然/非自然原因？](#5.是否有造成森林退化的自然/非自然原因？)


#### 导入所需的库并读取数据


```python
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import matplotlib.ticker as mtick
import seaborn as sns
from matplotlib.patches import Patch
from matplotlib.lines import Line2D

%matplotlib inline
```


```python
amazon_fires = pd.read_csv("./input/inpe_brazilian_amazon_fires_1999_2019.csv")
amazon_fires.head()
```




<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>year</th>
      <th>month</th>
      <th>state</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>firespots</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1999</td>
      <td>1</td>
      <td>AMAZONAS</td>
      <td>-2.371113</td>
      <td>-59.899933</td>
      <td>3</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1999</td>
      <td>1</td>
      <td>MARANHAO</td>
      <td>-2.257395</td>
      <td>-45.487831</td>
      <td>36</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1999</td>
      <td>1</td>
      <td>MATO GROSSO</td>
      <td>-12.660633</td>
      <td>-55.057989</td>
      <td>18</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1999</td>
      <td>1</td>
      <td>PARA</td>
      <td>-2.474820</td>
      <td>-48.546967</td>
      <td>87</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1999</td>
      <td>1</td>
      <td>RONDONIA</td>
      <td>-12.861700</td>
      <td>-60.513100</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>



首先，我们分析情况，按年，月和状态检测火灾爆发。


```python
# Generating years for the graph axis labels
int_year = list(range(1999, 2020))

plt.figure(figsize=(12,5), dpi=85)
sns.set_style("whitegrid")

sns.lineplot(data=amazon_fires, x='year', y='firespots', estimator='sum', color="firebrick")

plt.ylabel("Total number of fire outbreaks", size="large")
plt.xlabel("Year", size="large")
plt.xticks(int_year, rotation=30)
plt.title("Sum of Fire Outbreaks Detected per Year", size="x-large")
plt.grid(axis='x')
```


![png](https://whiterr.github.io/images/Brazilian_rain_forest/output_8_0.png)


上图显示了自1999年以来INPE每年检测到的亚马逊火灾总数。置信度为95％。

总体来说，亚马逊地区的火灾爆发次数似乎在2002年达到了一个非常重要的高峰，而今年之后，这一趋势在2011年之前逐渐减少。从这一点到今天，火灾爆发的次数可以略有增加。 注意。

请注意，由于是在2019年12月13日提取的，因此2019年的数据并不完整。


```python
# Month names in full length
fullmonth = ['January', 'February', 'March', 'April', 'May', 'June',
             'July', 'August', 'September', 'October', 'November', 'December']

plt.figure(figsize=(12,5), dpi=85)
sns.set_style("whitegrid")

sns.barplot(data=amazon_fires, x='month', y='firespots', color="firebrick")

plt.grid(False)
plt.ylabel("Total number of fire spots", size="large")
plt.title("Average Fire Oubreaks by Month", size="x-large")
plt.xlabel("Month", size="large")
plt.xticks(ticks=amazon_fires['month'].unique()-1, labels=fullmonth);
```


![png](https://whiterr.github.io/images/Brazilian_rain_forest/output_10_0.png)


下图显示了INPE在1999年至2019年期间每个月在亚马逊地区平均发现的火灾。置信度为95％。

该图显示，一年中的下半年平均受火灾影响最大，前三名是9月，8月和10月。


```python
legal_amazon = (
    amazon_fires[['state','firespots']].groupby('state',as_index=False)
    .sum()
    .sort_values('firespots',ascending=False)['state']
    .values
)

plt.figure(figsize=(12,5), dpi=85)
sns.set_style("whitegrid")

sns.barplot(data=amazon_fires, x='firespots', y='state', estimator=sum, color='firebrick', order=legal_amazon, ci=None)    

plt.ylabel("State", size="large")
plt.title("Total Fire Outbreaks by State", size="x-large")
plt.xlabel("Total number of fire outbreaks", size="large");
```


![png](https://whiterr.github.io/images/Brazilian_rain_forest/output_12_0.png)


了解哪个州受火灾影响最大也很重要。 

下图显示了数据集中所有州所有年份的火灾爆发总数。 帕拉州和马托格罗索州是受亚马逊河大火影响最大的巴西州，其火灾爆发总数是其他州加起来的至少两倍。

更好地了解问题和当前状况。现在是时候深入研究数据了。

州和年份
让我们一起分析这两个功能。 多年来每个州的行为如何？

下图显示了每个州的火灾爆发总数。


```python
legal_amazon = (
    amazon_fires[['state','firespots']].groupby('state',as_index=False)
    .sum()
    .sort_values('firespots',ascending=False)['state']
    .values
)

fig, ax = plt.subplots(3, 3, figsize=(14, 10), sharex=True)
sns.set_style("whitegrid")
ax = ax.flat

i=0
for x in legal_amazon:
    sns.lineplot(data=amazon_fires[amazon_fires['state'] == x], x='year',
                 y='firespots', estimator='sum', ax=ax[i], color='firebrick', ci=None)
    ax[i].set_title(x, size='large')
    ax[i].set_xlabel("Year", size='large')
    ax[i].set_xticks([2000, 2005, 2010, 2015, 2020])
    ax[i].grid(False)
    ax[i].set_xticklabels([2000, 2005, 2010, 2015, 2020], fontsize='large')
    
    if i==0 or i==3 or i==6:
        ax[i].set_ylabel("Total number of fire outbreaks", size='large')
    else:
        ax[i].set_ylabel("")
    
    i += 1

plt.subplots_adjust(wspace=0.16, hspace=0.12)
```


![png](https://whiterr.github.io/images/Brazilian_rain_forest/output_15_0.png)


来自图表的见解：

我们先前在2002年注意到的高峰似乎主要是由帕拉，马托格罗索州和朗多尼亚大火引起的。 这三个州在2002年达到顶峰，并逐渐减少火灾爆发次数，直到2011年为止。

Maranhao，Acre和Tocantins表现出相同的行为，但规模较小。

Amazonas似乎没有相同的行为。 在这种情况下，自2002年至2011年，大火爆发有所减少，然后再次增加，接近迄今为止的最坏月份。 对于Roraima来说也是一样，它在2019年爆发了最多的火灾。

Amapa没有显示明确的行为。

州和月份
现在，让我们看看全年的火灾爆发行为。 下图显示了每个州每月爆发的平均值（置信区间= 95％）。

除罗赖马（Roraima）怪异之外，所有州的火灾似乎都集中在该年度的下半年。 对于这种状态，火灾爆发的高峰似乎在几个月后才开始滞后，从十月开始，第二年三月达到高峰。


```python
fig, ax = plt.subplots(3, 3, figsize=(14, 10), sharex=True)
sns.set_style("whitegrid")
ax = ax.flat

i=0
for x in legal_amazon:
    sns.barplot(data=amazon_fires[amazon_fires['state'] == x], x='month',
                y='firespots', ax=ax[i], color='firebrick')
    ax[i].set_title(x, size='large')
    ax[i].grid(False)
    ax[i].set_xticklabels([1,2,3,4,5,6,7,8,9,10,11,12], fontsize='large');
    
    if x in ['PARA', 'AMAZONAS', 'RORAIMA']:
        ax[i].set_ylabel("Total number os fire outbreaks", size='large')
    else:
        ax[i].set_ylabel("");
    
    if x in ['RORAIMA', 'AMAPA', 'TOCANTINS']:
        ax[i].set_xlabel("Month", size='large')
    else:
        ax[i].set_xlabel("");
    
    i += 1
```


![png](https://whiterr.github.io/images/Brazilian_rain_forest/output_18_0.png)


年，月和状态
有趣的是要注意每月的行为以及多年来的变化。 下面的热图显示了每年各州每年月份的火灾爆发量。

色标没有共享，因此我们可以更好地查看每种状态的个体行为。


```python
fig, ax = plt.subplots(3, 3, figsize=(14, 10), sharex=True, sharey=True)
ax = ax.flat

i=0
for x in legal_amazon:
    st_month_year_pivot = amazon_fires[amazon_fires['state'] == x].pivot_table(values='firespots', index='month', columns='year', aggfunc='sum')
    
    sns.heatmap(data=st_month_year_pivot, xticklabels=int_year, ax=ax[i], cmap='YlOrBr', cbar=False)
    
    ax[i].set_ylabel("Month", size='large')
    ax[i].set_xlabel("Year", size='large')
    ax[i].set_title(x, size='large')
    ax[i].set_xticklabels(int_year, fontsize='large')
    ax[i].set_yticklabels([1,2,3,4,5,6,7,8,9,10,11,12], fontsize='large')
    
    for _, spine in ax[i].spines.items():
        spine.set_visible(True)
        
    ax[i].xaxis.set_visible(False)
    ax[i].yaxis.set_visible(False)
    
    i += 1
    

for a in [ax[0], ax[3], ax[6]]:
    a.yaxis.set_visible(True)
    
for a in [ax[6], ax[7], ax[8]]:
    a.xaxis.set_visible(True)
    
plt.subplots_adjust(wspace=0.05, hspace=0.1)
```


![png](https://whiterr.github.io/images/Brazilian_rain_forest/output_20_0.png)


情节见解：

亚马逊地区在2019年8月达到峰值。热图显示，本月记录的火灾爆发数量高于一年中这一时期的平均水平（自1999年以来的最高水平），这可能表明存在由于非自然原因引起的烧伤。

Roraima在2019年3月和2019年4月表现出类似的行为。在这些月份中，这种火灾的数量高于当年同期的平均水平。自1999年以来，3月是该州历史上火点最多的一年。

帕拉州和亚马孙州是一年中火灾发生最严重的州，几乎整个学期都达到了。就面积而言，这些也是合法亚马逊地区最大的州。

Para，Mato Grosso，Rondonia，Maranhao和Tocantins显示，与早期的数据收集相比，火灾爆发的次数大大减少了。 Amazonas，Acre，Roraima和Amapa没有显示相同的行为。

2019年12月没有所有数据，因为它们是本月从网站提取的。

1.4.3-往年的指标
我想将最近几年与历史数据进行比较。

为此，下图在左侧以列显示了参考年，而前几年的最小值，平均值和最大值（计算不包括参考年）。 在右图中，最大值由每个月的100％表示，而平均值和2017年值则与最大值相关。

该图绘制到2017年，2018年和2019年。


```python
# Function to make the calculations
def previous_years_metrics(ds, year):
    ds_grouped = (
        ds[ds['year'] < year].groupby(['year','month'])
        .sum()
        .groupby('month')
        .aggregate([min, max, np.mean])
    )['firespots']
    
    ds_grouped[f'{year}'] = ds[ds['year'] == year].groupby('month')['firespots'].sum()
    ds_grouped[f'{year}_max'] = (ds_grouped[f'{year}'] / ds_grouped['max']) *100
    ds_grouped['avg_max'] = (ds_grouped['mean'] / ds_grouped['max']) *100
    
    return ds_grouped
```


```python
# Applying the function
month_statistics_2017 = previous_years_metrics(amazon_fires, 2017)
month_statistics_2018 = previous_years_metrics(amazon_fires, 2018)
month_statistics_2019 = previous_years_metrics(amazon_fires, 2019)
```


```python
# Funcion to build the plots
def plot_year_row(dataset, year, ax1, ax2):
    fmt = '%.0f%%' # Format you want the ticks, e.g. '40%'
    xticks = mtick.FormatStrFormatter(fmt)
    months = dataset.index
    
    ax1.bar(dataset.index, dataset[f'{year}'], align='center', color='whitesmoke', alpha=1, label=f"{year}", 
            edgecolor='grey', linewidth=1)
    sns.lineplot(data=dataset, x=dataset.index, y='min', color="goldenrod", lw=4, alpha=0.7, label="Minimum", ax=ax1)
    sns.lineplot(data=dataset, x=dataset.index, y='mean', color="orangered", lw=4, alpha=0.7, label="Average", ax=ax1)
    sns.lineplot(data=dataset, x=dataset.index, y='max', color="firebrick", lw=4, alpha=0.7, label="Maximum", ax=ax1)
    ax1.set_title(f"{year} vs Previous Years", size='large')
    ax1.set_xlabel("Month", size='large')
    ax1.set_ylabel("Fire outbreaks", size='large')
    ax1.grid(False)
    ax1.set_xticks(months)
    ax1.set_xticklabels(months, fontsize='large')
    ax1.legend(loc="upper left")

    ax2.bar(dataset.index, dataset[f'{year}_max'], align='center', color='whitesmoke', alpha=1, label=f"{year}", 
            edgecolor='grey', linewidth=1)
    sns.lineplot(data=dataset, x=dataset.index, y='avg_max', color="orangered", lw=4, alpha=0.7, label="Average", ax=ax2)
    ax2.axhline(y=100, color='firebrick', linestyle='-', lw=3.5, alpha=0.8, label="Maximum")
    ax2.set_title(f"{year}, vs Previous Years (percentage of maximum)", size='large')
    ax2.set_xlabel("Month", size='large')
    ax2.set_ylabel("Fire Outbreaks (% of maximum)", size='large')
    ax2.yaxis.set_major_formatter(xticks)
    ax2.grid(False)
    ax2.set_xticks(months)
    ax2.set_xticklabels(months, fontsize='large')
    ax2.legend(loc="upper right")
```


```python
# Applying the function
fig, ax = plt.subplots(3, 2, figsize = (18,16), dpi=85, sharex=True)
sns.set_style("whitegrid")
plt.subplots_adjust(wspace=0.16, hspace=0.16)
ax = ax.flat

plot_year_row(month_statistics_2017, 2017, ax[0], ax[1])
plot_year_row(month_statistics_2018, 2018, ax[2], ax[3])
plot_year_row(month_statistics_2019, 2019, ax[4], ax[5])
```


![png](https://whiterr.github.io/images/Brazilian_rain_forest/output_26_0.png)


这些图的见解：

+ 2017年，只有7月高于平均火灾爆发水平，4月，9月和12月接近火灾爆发的平均水平。 其他月份低于平均水平。 还没有一个月接近最高值。
+ 在2018年，2月和3月的火灾爆发次数超过往年平均水平。 剩下的几个月还差一点。
+ 2019年是这些年中唯一一次超过3月和4月的最高年份。 两者的燃烧量都超过了今年最高燃烧量的150％。 另外，2月和8月达到每个月往年的平均值。 其余月份低于平均水平。 12月份的数据不完整，因此尚无法分析。
+ 重要的是要记住，这些最大值，平均值和最小值计算包括2002年至2005年左右的年份，这些年份的火灾爆发数量令人无法接受。 我们不应该使用这些年份的值来断定现在的情况会更好。


```python

```
